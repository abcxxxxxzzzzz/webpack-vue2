"use strict";(self["webpackChunkwebpack_vue"]=self["webpackChunkwebpack_vue"]||[]).push([[396],{7396:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"box-card",staticStyle:{width:"100%"},attrs:{shadow:"hover"}},[t("el-dialog",{attrs:{title:e.modelTitle,visible:e.dialogVisible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"站点名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"站点名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"===typeof t?t.trim():t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"域",prop:"domainStr"}},[t("el-input",{attrs:{type:"textarea",rows:"100",maxlength:2e4,autosize:{minRows:10,maxRows:1e3},placeholder:"请输入域,一行一个,不允许有空格,Example: a.com"},model:{value:e.form.domainStr,callback:function(t){e.$set(e.form,"domainStr",t)},expression:"form.domainStr"}})],1),t("el-form-item",{attrs:{label:"终端区分"}},[t("el-switch",{model:{value:e.form.is_agent,callback:function(t){e.$set(e.form,"is_agent",t)},expression:"form.is_agent"}})],1),t("el-form-item",{attrs:{label:"路径跟随"}},[t("el-switch",{model:{value:e.form.is_query,callback:function(t){e.$set(e.form,"is_query",t)},expression:"form.is_query"}})],1),t("el-form-item",{attrs:{label:"SSL证书"}},[t("el-switch",{model:{value:e.form.is_ssl,callback:function(t){e.$set(e.form,"is_ssl",t)},expression:"form.is_ssl"}})],1),e.form.is_ssl?t("el-form-item",{attrs:{label:"CRT",prop:"crt_pem"}},[t("el-input",{attrs:{type:"textarea",rows:"100",maxlength:2e4,autosize:{minRows:10,maxRows:1e3},placeholder:"请输入正确的CRT或PEM证书,仅支持NGINX"},model:{value:e.form.crt_pem,callback:function(t){e.$set(e.form,"crt_pem",t)},expression:"form.crt_pem"}})],1):e._e(),e.form.is_ssl?t("el-form-item",{attrs:{label:"KEY",prop:"key_pem"}},[t("el-input",{attrs:{type:"textarea",rows:"100",maxlength:2e4,autosize:{minRows:10,maxRows:1e3},placeholder:"请输入正确的证书KEY,无效KEY会导致部署失败,仅支持NGINX"},model:{value:e.form.key_pem,callback:function(t){e.$set(e.form,"key_pem",t)},expression:"form.key_pem"}})],1):e._e(),t("el-form-item",{attrs:{label:"默认地址",prop:"p_url"}},[t("el-input",{attrs:{placeholder:"Example: http://pc.com or https://pc.com"},model:{value:e.form.p_url,callback:function(t){e.$set(e.form,"p_url","string"===typeof t?t.trim():t)},expression:"form.p_url"}})],1),e.form.is_agent?t("el-form-item",{attrs:{label:"移动地址",prop:"m_url"}},[t("el-input",{attrs:{placeholder:"Example: http://m.com or https://m.com"},model:{value:e.form.m_url,callback:function(t){e.$set(e.form,"m_url","string"===typeof t?t.trim():t)},expression:"form.m_url"}})],1):e._e()],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.cancel}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1),t("div",{staticClass:"manage-header"},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v(" 新增 ")]),t("el-input",{attrs:{placeholder:"请输入搜索的站点或域",size:"mini",width:"200px",clearable:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchEnter.apply(null,arguments)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[t("el-select",{staticStyle:{width:"95px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[t("el-option",{attrs:{label:"站点",value:"web"}}),t("el-option",{attrs:{label:"域名",value:"domain"}})],1),t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchEnter},slot:"append"})],1),t("div",{staticStyle:{float:"right","margin-right":"20px"}},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新 Redis 缓存",placement:"top-start"}},[t("el-button",{staticStyle:{"margin-right":"15px"},attrs:{icon:"el-icon-s-order",size:"mini",circle:""},on:{click:e.CacheUpdate}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"清空 Redis 缓存",placement:"top-start"}},[t("el-button",{staticStyle:{"margin-right":"15px"},attrs:{icon:"el-icon-delete",size:"mini",circle:""},on:{click:e.CacheDelete}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新数据",placement:"top-start"}},[t("el-button",{attrs:{icon:"el-icon-refresh",size:"mini",circle:""},on:{click:e.searchEnter}})],1)],1)],1),t("div",{staticClass:"manage-container"},[[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"max-height":"630",border:"","header-cell-style":{background:"#fff"}}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return 1==a.row.is_ssl?[t("el-form",{staticClass:"demo-table-expand",staticStyle:{"margin-left":"100px"},attrs:{"label-position":"left",inline:""}},[t("el-form-item",{attrs:{label:"此证书相关联域名"}},e._l(a.row.ssl_domains.split(","),(function(a){return t("el-tag",{key:a,staticStyle:{margin:"0 5px 0 5px"},attrs:{closable:"",type:"success"}},[e._v(" "+e._s(a)+" ")])})),1)],1)]:void 0}}],null,!0)}),t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{prop:"id",label:"ID"}}),t("el-table-column",{attrs:{prop:"name",label:"站点名称",width:"150px"}}),t("el-table-column",{attrs:{prop:"is_ssl",label:"证书SSL"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.is_ssl?t("el-tag",{key:a.$index,attrs:{type:"success",effect:"dark",size:"mini"}},[e._v(" Open ")]):0==a.row.is_ssl?t("el-tag",{key:a.$index,attrs:{type:"info",effect:"dark",size:"mini"}},[e._v(" Close ")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"is_agent",label:"区分终端"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.is_agent?t("el-tag",{key:a.$index,attrs:{type:"success",effect:"dark",size:"mini"}},[e._v(" Open ")]):0==a.row.is_agent?t("el-tag",{key:a.$index,attrs:{type:"info",effect:"dark",size:"mini"}},[e._v(" Close ")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"is_query",label:"携带路径"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.is_query?t("el-tag",{key:a.$index,attrs:{type:"success",effect:"dark",size:"mini"}},[e._v(" Open ")]):0==a.row.is_query?t("el-tag",{key:a.$index,attrs:{type:"info",effect:"dark",size:"mini"}},[e._v(" Close ")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"is_deploy",label:"已部署"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.is_deploy?t("el-tag",{key:a.$index,attrs:{type:"success",effect:"dark",size:"mini"}},[e._v(" Yes ")]):0==a.row.is_deploy?t("el-tag",{key:a.$index,attrs:{type:"info",effect:"dark",size:"mini"}},[e._v(" No ")]):e._e()]}}])}),t("el-table-column",{attrs:{prop:"m_url",label:"移动地址",width:"180px"}}),t("el-table-column",{attrs:{prop:"p_url",label:"默认地址",width:"180px"}}),t("el-table-column",{attrs:{prop:"expire_date",label:"证书过期日期",width:"180px"}}),t("el-table-column",{attrs:{prop:"updated_at",label:"更新时间",width:"180px"}}),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"180px"}}),t("el-table-column",{attrs:{label:"操作",width:"180",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",icon:"el-icon-view",circle:""},on:{click:function(t){return e.handleShow(a.$index,a.row)}}}),t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit-outline",circle:""},on:{click:function(t){return e.handleEdit(a.$index,a.row)}}}),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.handleDelete(a.$index,a.row)}}}),a.row.is_ssl?t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"部署到 NGINX",placement:"top-start"}},[t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-s-promotion",circle:""},on:{click:function(t){return e.handleDeployNgx(a.row)}}})],1):e._e()]}}])})],1),t("el-pagination",{attrs:{"current-page":e.page,"page-sizes":e.pageSizes,"page-size":e.per_page,layout:"total, sizes, prev, pager, next, jumper",total:e.totalData},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})]],2),t("el-drawer",{attrs:{title:e.domainTitle,visible:e.domainVisible,direction:"rtl",size:"30%"},on:{"update:visible":function(t){e.domainVisible=t}}},[t("el-table",{staticStyle:{"padding-left":"5%"},attrs:{data:e.domainData}},[t("el-table-column",{attrs:{property:"name",label:"域",width:"500"}})],1)],1)],1)},r=[],i=(a(7658),a(1703)),l={name:"shop",data(){var e=(e,t,a)=>{if(this.form.is_ssl&&!t)return a(new Error("CRT不能为空!"));a()},t=(e,t,a)=>{if(this.form.is_ssl&&!t)return a(new Error("KEY不能为空!"));a()},a=(e,t,a)=>{if(this.form.is_agent&&!t)return a(new Error("移动地址不能为空!"));a()};return{loading:!1,pageSizes:[20,50,100,300],per_page:20,page:1,totalData:0,searchType:"web",search:"",searchName:"",dialogVisible:!1,modelTitle:"",modelType:0,modelEditIndex:"",tableData:[],domainVisible:!1,domainTitle:"",domainData:[],multipleSelection:[],form:{id:"",name:"",domainStr:"",domain:[],crt_pem:"",key_pem:"",is_agent:!1,is_query:!1,is_deploy:!1,is_ssl:!1,p_url:"",m_url:""},rules:{name:[{required:!0,message:"请输入站点名称",trigger:"blur"}],domainStr:[{required:!0,message:"请输入域",trigger:"blur"}],p_url:[{required:!0,message:"请输入默认地址",trigger:"blur"}],m_url:[{validator:a,trigger:"blur"}],crt_pem:[{validator:e,trigger:"blur"}],key_pem:[{validator:t,trigger:"blur"}]}}},methods:{handleClose(e){this.dialogVisible=!1,this.$refs.form.resetFields()},cancel(){this.handleClose()},getDataList(){(0,i.Th)({page:this.page,per_page:this.per_page,search:this.search,searchType:this.searchType}).then((e=>{if(200===e.data.code){const t=e.data.data;t.data.forEach((e=>{e.domainStr=e.domain.join("\n")})),this.tableData=t.data;const a=t.pagination;this.per_page=a.per_page,this.page=a.page,this.totalData=a.total}else this.$message.error("Get List ERROR!")}))},submit(){this.$refs.form.validate((e=>{e?(this.form.domain=this.form.domainStr.split("\n"),delete this.form.domainStr,0===this.modelType?(0,i.Zi)(this.form).then((e=>{if(200===e.data.code){this.$message.success("ADD SUCCESS!");const t=e.data.data;t.domainStr=t.domain.join("\n"),this.tableData.push(t)}else this.$message.error(e.data.msg);this.dialogVisible=!1,this.$refs.form.resetFields()})):(delete this.form.created_at,delete this.form.expire_date,delete this.form.ssl_domains,delete this.form.updated_at,delete this.form.is_deploy,(0,i.TM)(this.form).then((e=>{if(200===e.data.code){const t=e.data.data;t.domainStr=t.domain.join("\n"),this.$set(this.tableData,this.modelEditIndex,t),this.$message.success("Update SUCCESS!")}else this.$message.error(e.data.msg);this.dialogVisible=!1,this.$refs.form.resetFields()})))):this.$message.warning("Error submit!!")}))},searchEnter(){(0,i.Th)({page:this.page,per_page:this.per_page,search:this.search,searchType:this.searchType}).then((e=>{if(200===e.data.code){const t=e.data.data;t.data.forEach((e=>{var t=[],a=e.domain;a.forEach((e=>{t.push(e.name)})),e.domain=t.join("\n")})),this.tableData=t.data;const a=t.pagination;this.per_page=a.per_page,this.page=a.page,this.totalData=a.total}else this.$message.error("ADD ERROR!")}))},handleShow(e,t){this.domainTitle=t.name,this.domainVisible=!0;var a=t.domain,s=[];s=a.map((t=>({id:e+1,name:t})));this.domainData=s},handleAdd(){this.modelType=0,this.modelTitle="添加",this.form={name:"",domain:"",crt_pem:"",key_pem:"",is_agent:!1,is_query:!1,is_ssl:!1,p_url:"",m_url:""},this.dialogVisible=!0},handleEdit(e,t){this.modelType=1,this.modelTitle="编辑",this.dialogVisible=!0,this.form=JSON.parse(JSON.stringify(t)),this.modelEditIndex=e},handleDelete(e,t){this.$prompt("此操作将永久删除 "+t.name+" , 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入你要删除的站点名字: "+t.name,type:"warning"}).then((a=>{a.value==t.name?(0,i.qm)({id:t.id}).then((t=>{console.log(t),200==t.data.code?(this.tableData.splice(e,1),this.$message.success("删除成功!")):this.$message.error("删除失败!")})):this.$message.warning("输入错误,请重新发起删除请求!")})).catch((()=>{this.$message.info("已取消删除")}))},handleDeployNgx(e){(0,i.JH)({id:e.id}).then((e=>{200==e.data.code?(this.$message.success("NGINX configuration was successfully deployed.!"),this.getDataList()):this.$message.error("NGINX configuration deployment failed!")}))},handleSelectionChange(e){console.log(e),this.multipleSelection=e},handleSizeChange(e){this.per_page=e,this.getDataList(),console.log(`每页 ${e} 条`)},handleCurrentChange(e){this.page=e,this.getDataList(),console.log(`当前页: ${e}`)},dateFormat(e){var t=new Date(e),a=t.getFullYear(),s=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),l=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),o=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return a+"-"+s+"-"+r+" "+i+":"+l+":"+o},CacheUpdate(){(0,i.v$)().then((e=>{200===e.data.code?this.$message.success("Cache refresh succeeded."):this.$message.errror("Cache refresh failed, Please check the server of redis.")}))},CacheDelete(){(0,i.Nx)().then((e=>{200===e.data.code?this.$message.success("Cache delete succeeded."):this.$message.errror("Cache delete failed, Please check the server of redis.")}))}},created(){this.getDataList()}},o=l,n=a(1001),c=(0,n.Z)(o,s,r,!1,null,"38e8a0f9",null),m=c.exports},7141:function(e,t,a){a.d(t,{Z:function(){return g}});var s=a(7934),r=a.n(s),i=a(4002),l=a.n(i),o=(a(7658),a(70)),n={baseUrl:{dev:"/api/",pro:""}},c=a(4655);let m,d=0;function p(){0==d&&(m=l().service({lock:!0,text:"拼命加载中...",background:"rgba(255,255,255,0.5)"})),d++}function u(){d--,d<=0&&m.close()}const h=n.baseUrl.pro;class f{constructor(e){this.baseUrl=e}getInsideConfig(){this.baseUrl}interceptors(e){e.interceptors.request.use((function(e){p();const t=localStorage.getItem("token");return t&&(e.headers["X-Token"]=t),e}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){return u(),e}),(function(e){if(u(),e&&e.response)switch(e.response.status){case 400:e.message="请求错误(400),请刷新重试~~~"+e.response.data.msg;break;case 401:localStorage.removeItem("token"),c.Z.push("/login");break;case 403:e.message="拒绝访问(403) "+e.response.data.msg;break;case 404:e.message="请求出错(404) "+e.response.data.msg;break;case 408:e.message="请求超时(408) "+e.response.data.msg;break;case 500:e.message="服务器错误(500) "+e.response.data.msg;break;case 501:e.message="服务未实现(501) "+e.response.data.msg;break;case 502:e.message="网络错误(502) "+e.response.data.msg;break;case 503:e.message="服务不可用(503) "+e.response.data.msg;break;case 504:e.message="网络超时(504) "+e.response.data.msg;break;case 505:e.message="HTTP版本不受支持(505) "+e.response.data.msg;break;default:e.message=`连接出错(${e.response.status})!`}else e.message="连接服务器失败!";return r().error(e.message),Promise.reject(e)}))}request(e){const t=o.Z.create();return e={...this.getInsideConfig(),...e},this.interceptors(t),t(e)}}var g=new f(h)},1703:function(e,t,a){a.d(t,{JH:function(){return p},Nx:function(){return d},RD:function(){return i},TM:function(){return n},Th:function(){return l},Zi:function(){return o},m3:function(){return r},qm:function(){return c},v$:function(){return m}});var s=a(7141);const r=e=>s.Z.request({url:"/api/v1/auth/login",method:"post",data:e}),i=e=>s.Z.request({url:"/api/v1/auth/logout",method:"delete",data:e}),l=e=>s.Z.request({url:"/api/v1/manage",method:"get",params:e}),o=e=>s.Z.request({url:"/api/v1/manage",method:"post",data:e}),n=e=>s.Z.request({url:"/api/v1/manage/"+e.id,method:"put",data:e}),c=e=>s.Z.request({url:"/api/v1/manage/"+e.id,method:"delete"}),m=e=>s.Z.request({url:"/api/v1/manage/cache",method:"post",data:e}),d=e=>s.Z.request({url:"/api/v1/manage/cache",method:"delete",params:e}),p=e=>s.Z.request({url:"/api/v1/manage/deploy/"+e.id,method:"post"})}}]);
//# sourceMappingURL=396.ec64a2db.js.map